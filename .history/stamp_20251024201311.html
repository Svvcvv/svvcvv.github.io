<!DOCTYPE html>
<html lang="zh" class="js">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <!-- 引入 Font Awesome 图标库（CDN 方式） -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" 
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" 
      crossorigin="anonymous" referrerpolicy="no-referrer" />
         <link rel="stylesheet" href="/assets/css/dashlite.css">
	<link rel="stylesheet" href="/assets/css/style2.css">
    <title>在线电子印章生成器</title>
  </head>
  <body class="nk-body npc-invest bg-lighter">
    <div class="nk-content nk-content-lg nk-content-fluid">
      <div class="mt-5 text-center">
          <h3>电子印章生成器</h3>
          <div class="accordion-inner">
            <p>
              电子印章生成器是一款专业免费的在线电子章制作工具，支持多种公章、合同章、财务章、法人章模板，轻松自定义印章大小、颜色、文字、LOGO，满足企业电子合同、公文签署、发票盖章等多种需求。快速生成高质量电子印章，支持高清下载和多格式导出，适合企业、个人在线印章设计和使用。
            </p>
        </div>
      </div>
    </div>
    <div class="seal-gen-container" id="app">
      <div class="seal-gen-generator-container">
        <div class="seal-gen-controls-section">
          <!-- 基本设置 -->

          <div class="seal-gen-control-card">
            <h3><i class="fas fa-cog"></i> 基本设置</h3>
            <div class="seal-gen-form-group">
              <label>印章类型</label>
              <select id="sealType" class="seal-gen-form-control">
                <option value="circle">圆形公章</option>
                <option value="ellipse">椭圆公司章</option>
                <option value="invoice">发票专用章</option>
                <option value="square">方形印章</option>
                <option value="triangle">三角形印章</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label>主文字内容</label>
              <input
                type="text"
                id="mainText"
                class="seal-gen-form-control"
                value="示例有限公司"
              />
            </div>

            <div class="seal-gen-form-group">
              <label
                >副文字/编号<br /><small>（回车换行，最多两行）</small></label
              >
              <textarea
                id="subText"
                class="seal-gen-form-control"
                rows="2"
                placeholder="例如：&#10;财务专用章&#10;No.123456"
              ></textarea>
            </div>

            <div class="seal-gen-form-group">
              <label>主文字颜色</label>
              <input
                type="color"
                id="mainTextColor"
                class="seal-gen-form-control"
                value="#cc0000"
              />
            </div>

            <div class="seal-gen-form-group">
              <label>副文字颜色</label>
              <input
                type="color"
                id="subTextColor"
                class="seal-gen-form-control"
                value="#cc0000"
              />
            </div>

            <div class="seal-gen-form-group">
              <label>印章颜色</label>
              <input
                type="color"
                id="sealColor"
                class="seal-gen-form-control"
                value="#cc0000"
              />
            </div>

            <div class="seal-gen-form-group">
              <label>背景颜色</label>
              <input
                type="color"
                id="bgColor"
                class="seal-gen-form-control"
                value="#ffffff"
              />
            </div>

            <div class="seal-gen-form-group">
              <label
                ><input type="checkbox" id="transparentBg" /> 透明背景
                (仅PNG有效)</label
              >
            </div>
          </div>

          <!-- 防伪码设置 -->
          <div class="seal-gen-control-card">
            <h3><i class="fas fa-shield-alt"></i> 防伪码设置</h3>
            <div class="seal-gen-form-group">
              <label
                ><input type="checkbox" id="enableAntiCounterfeit" />
                启用防伪码</label
              >
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码类型</label>
              <select id="antiCounterfeitType" class="seal-gen-form-control">
                <option value="auto">自动生成</option>
                <option value="custom">自定义内容</option>
                <option value="timestamp">时间戳</option>
                <option value="uuid">UUID编码</option>
              </select>
            </div>

            <div class="seal-gen-form-group" id="customAntiCounterfeitGroup">
              <label>自定义防伪码</label>
              <input
                type="text"
                id="customAntiCounterfeit"
                class="seal-gen-form-control"
                placeholder="请输入自定义防伪码"
              />
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码字体</label>
              <select id="antiCounterfeitFont" class="seal-gen-form-control">
                <option value="Arial,sans-serif">Arial</option>
                <option value="Courier New,monospace" selected>
                  Courier New
                </option>
                <option value="Times New Roman,serif">Times New Roman</option>
                <option value="Georgia,serif">Georgia</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码大小</label>
              <input
                type="range"
                id="antiCounterfeitSize"
                class="seal-gen-form-control"
                min="6"
                max="20"
                value="10"
              />
              <span class="seal-gen-range-value" id="antiCounterfeitSizeValue"
                >10</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码颜色</label>
              <input
                type="color"
                id="antiCounterfeitColor"
                class="seal-gen-form-control"
                value="#666666"
              />
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码位置</label>
              <select
                id="antiCounterfeitPosition"
                class="seal-gen-form-control"
              >
                <option value="bottom">底部</option>
                <option value="top">顶部</option>
                <option value="left">左侧</option>
                <option value="right">右侧</option>
                <option value="center">中心</option>
                <option value="arc-bottom" selected>底部弧形</option>
                <option value="arc-top">顶部弧形</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码X偏移</label>
              <input
                type="range"
                id="antiCounterfeitOffsetX"
                class="seal-gen-form-control"
                min="-100"
                max="100"
                value="0"
              />
              <span
                class="seal-gen-range-value"
                id="antiCounterfeitOffsetXValue"
                >0</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码Y偏移</label>
              <input
                type="range"
                id="antiCounterfeitOffsetY"
                class="seal-gen-form-control"
                min="-100"
                max="100"
                value="0"
              />
              <span
                class="seal-gen-range-value"
                id="antiCounterfeitOffsetYValue"
                >0</span
              >px
            </div>

            <div class="seal-gen-form-group" id="antiCounterfeitArcGroup">
              <label>防伪码弧度</label>
              <input
                type="range"
                id="antiCounterfeitCurve"
                class="seal-gen-form-control"
                min="0"
                max="100"
                value="30"
              />
              <span class="seal-gen-range-value" id="antiCounterfeitCurveValue"
                >30</span
              >%
            </div>

            <div class="seal-gen-form-group" id="antiCounterfeitSpacingGroup">
              <label>防伪码字符间距</label>
              <input
                type="range"
                id="antiCounterfeitSpacing"
                class="seal-gen-form-control"
                min="0"
                max="10"
                value="2"
              />
              <span
                class="seal-gen-range-value"
                id="antiCounterfeitSpacingValue"
                >2</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码透明度</label>
              <input
                type="range"
                id="antiCounterfeitOpacity"
                class="seal-gen-form-control"
                min="10"
                max="100"
                value="60"
              />
              <span
                class="seal-gen-range-value"
                id="antiCounterfeitOpacityValue"
                >60</span
              >%
            </div>

            <div class="seal-gen-form-group">
              <label
                ><input type="checkbox" id="antiCounterfeitBold" />
                防伪码粗体</label
              >
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码方向</label>
              <select
                id="antiCounterfeitDirection"
                class="seal-gen-form-control"
              >
                <option value="horizontal">水平</option>
                <option value="vertical">垂直</option>
                <option value="auto">自动</option>
                <option value="clockwise">顺时针</option>
                <option value="counterclockwise">逆时针</option>
              </select>
              <div class="seal-gen-form-help">
                水平/垂直对直线位置有效，其他对弧形位置有效
              </div>
            </div>

            <div class="seal-gen-form-group">
              <label>防伪码顺序</label>
              <select id="antiCounterfeitOrder" class="seal-gen-form-control">
                <option value="normal">正序</option>
                <option value="reverse">倒序</option>
              </select>
            </div>

            <div class="seal-gen-action-buttons">
              <button
                class="seal-gen-btn seal-gen-btn-info"
                id="generateAntiCounterfeitBtn"
              >
                <i class="fas fa-sync-alt"></i> 重新生成防伪码
              </button>
            </div>
          </div>

          <!-- 文字设置 -->
          <div class="seal-gen-control-card">
            <h3><i class="fas fa-font"></i> 文字设置</h3>
            <div class="seal-gen-form-group">
              <label>主文字字体</label>
              <select id="mainFont" class="seal-gen-form-control">
                <option value="SimSun,宋体">宋体</option>
                <option value="SimHei,黑体">黑体</option>
                <option value="KaiTi,楷体">楷体</option>
                <option value="FangSong,仿宋" selected>仿宋</option>
                <option value="LiSu,隶书">隶书</option>
                <option value="YouYuan,幼圆">幼圆</option>
                <option value="Microsoft YaHei,微软雅黑">微软雅黑</option>
                <option value="STXihei,华文细黑">华文细黑</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label>主文字大小</label>
              <input
                type="range"
                id="mainFontSize"
                class="seal-gen-form-control"
                min="10"
                max="50"
                value="24"
              />
              <span class="seal-gen-range-value" id="mainFontSizeValue">24</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>主文字间距</label>
              <input
                type="range"
                id="mainLetterSpacing"
                class="seal-gen-form-control"
                min="0"
                max="30"
                value="5"
              />
              <span class="seal-gen-range-value" id="mainLetterSpacingValue"
                >5</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>主文字弧度</label>
              <input
                type="range"
                id="mainTextCurve"
                class="seal-gen-form-control"
                min="0"
                max="100"
                value="80"
              />
              <span class="seal-gen-range-value" id="mainTextCurveValue"
                >80</span
              >%
            </div>

            <div class="seal-gen-form-group">
              <label>主文字方向</label>
              <select id="mainTextDirection" class="seal-gen-form-control">
                <option value="clockwise">顺时针</option>
                <option value="counterclockwise">逆时针</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label><input type="checkbox" id="mainBold" /> 主文字粗体</label>
            </div>

            <div class="seal-gen-form-group">
              <label
                ><input type="checkbox" id="mainItalic" /> 主文字斜体</label
              >
            </div>

            <div class="seal-gen-form-group">
              <label>主文字径向偏移</label>
              <input
                type="range"
                id="mainTextOffset"
                class="seal-gen-form-control"
                min="-50"
                max="50"
                value="0"
              />
              <span class="seal-gen-range-value" id="mainTextOffsetValue"
                >0</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>主文字起始角度</label>
              <input
                type="range"
                id="mainTextStartAngle"
                class="seal-gen-form-control"
                min="0"
                max="360"
                value="144"
              />
              <span class="seal-gen-range-value" id="mainTextStartAngleValue"
                >144</span
              >°
            </div>

            <div class="seal-gen-form-group">
              <label>副文字字体</label>
              <select id="subFont" class="seal-gen-form-control">
                <option value="SimSun,宋体">宋体</option>
                <option value="SimHei,黑体">黑体</option>
                <option value="KaiTi,楷体">楷体</option>
                <option value="FangSong,仿宋" selected>仿宋</option>
                <option value="Microsoft YaHei,微软雅黑">微软雅黑</option>
                <option value="STXihei,华文细黑">华文细黑</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label>副文字大小</label>
              <input
                type="range"
                id="subFontSize"
                class="seal-gen-form-control"
                min="10"
                max="30"
                value="18"
              />
              <span class="seal-gen-range-value" id="subFontSizeValue">18</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>副文字垂直偏移</label>
              <input
                type="range"
                id="subTextOffset"
                class="seal-gen-form-control"
                min="-100"
                max="100"
                value="0"
              />
              <span class="seal-gen-range-value" id="subTextOffsetValue">0</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>副文字弧度</label>
              <input
                type="range"
                id="subTextCurve"
                class="seal-gen-form-control"
                min="0"
                max="100"
                value="0"
              />
              <span class="seal-gen-range-value" id="subTextCurveValue">0</span
              >%
            </div>

            <div class="seal-gen-form-group">
              <label>副文字间距</label>
              <input
                type="range"
                id="subLetterSpacing"
                class="seal-gen-form-control"
                min="0"
                max="30"
                value="2"
              />
              <span class="seal-gen-range-value" id="subLetterSpacingValue"
                >2</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>副文字方向</label>
              <select id="subTextDirection" class="seal-gen-form-control">
                <option value="clockwise">顺时针</option>
                <option value="counterclockwise">逆时针</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label>副文字起始角度</label>
              <input
                type="range"
                id="subTextStartAngle"
                min="40"
                max="140"
                value="90"
              />
              <span class="seal-gen-range-value" id="subTextStartAngleValue"
                >90</span
              >°
              <div class="seal-gen-form-help">
                40°≈左侧起点　90°≈正下方　140°≈右侧起点
              </div>
            </div>

            <div class="seal-gen-form-group">
              <label><input type="checkbox" id="subBold" /> 副文字粗体</label>
            </div>

            <div class="seal-gen-form-group">
              <label><input type="checkbox" id="subItalic" /> 副文字斜体</label>
            </div>
          </div>

          <!-- 边框与图案 -->
          <div class="seal-gen-control-card">
            <h3><i class="fas fa-border-style"></i> 边框与图案</h3>
            <div class="seal-gen-form-group">
              <label>边框样式</label>
              <select id="borderStyle" class="seal-gen-form-control">
                <option value="single">单线边框</option>
                <option value="double">双线边框</option>
                <option value="dashed">虚线边框</option>
                <option value="dotted">点状边框</option>
                <option value="none">无边框</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label>边框宽度</label>
              <input
                type="range"
                id="borderWidth"
                class="seal-gen-form-control"
                min="1"
                max="10"
                value="3"
              />
              <span class="seal-gen-range-value" id="borderWidthValue">3</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>内边距</label>
              <input
                type="range"
                id="padding"
                class="seal-gen-form-control"
                min="0"
                max="50"
                value="0"
              />
              <span class="seal-gen-range-value" id="paddingValue">0</span>px
            </div>

            <div class="seal-gen-form-group">
              <label>中心图案</label>
              <select id="centerPattern" class="seal-gen-form-control">
                <option value="star">五角星</option>
                <option value="none" selected>无</option>
                <option value="circle">圆形</option>
                <option value="square">方形</option>
                <option value="triangle">三角形</option>
                <option value="custom">自定义图片</option>
              </select>
            </div>

            <div
              class="seal-gen-form-group"
              id="customPatternGroup"
              style="display: none"
            >
              <label>上传自定义图案</label>
              <input
                type="file"
                id="customPattern"
                class="seal-gen-form-control"
                accept="image/*"
              />
            </div>

            <div class="seal-gen-form-group">
              <label>图案大小</label>
              <input
                type="range"
                id="patternSize"
                class="seal-gen-form-control"
                min="10"
                max="100"
                value="40"
              />
              <span class="seal-gen-range-value" id="patternSizeValue">40</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>图案颜色</label>
              <input
                type="color"
                id="patternColor"
                class="seal-gen-form-control"
                value="#cc0000"
              />
            </div>

            <div class="seal-gen-form-group">
              <label>图案X偏移</label>
              <input
                type="range"
                id="patternOffsetX"
                class="seal-gen-form-control"
                min="-50"
                max="50"
                value="0"
              />
              <span class="seal-gen-range-value" id="patternOffsetXValue"
                >0</span
              >px
            </div>

            <div class="seal-gen-form-group">
              <label>图案Y偏移</label>
              <input
                type="range"
                id="patternOffsetY"
                class="seal-gen-form-control"
                min="-50"
                max="50"
                value="0"
              />
              <span class="seal-gen-range-value" id="patternOffsetYValue"
                >0</span
              >px
            </div>
          </div>
        </div>

        <div class="seal-gen-preview-section">
          <div class="seal-gen-preview-card">
            <h3><i class="fas fa-eye"></i> 印章预览</h3>
            <div class="seal-gen-canvas-container">
              <canvas id="sealCanvas" width="400" height="400"></canvas>
            </div>
            <div class="seal-gen-preview-actions">
              <button class="seal-gen-btn seal-gen-btn-sm" id="zoomInBtn">
                <i class="fas fa-search-plus"></i> 放大
              </button>
              <button class="seal-gen-btn seal-gen-btn-sm" id="zoomOutBtn">
                <i class="fas fa-search-minus"></i> 缩小
              </button>
              <button class="seal-gen-btn seal-gen-btn-sm" id="rotateBtn">
                <i class="fas fa-redo"></i> 旋转
              </button>
            </div>
          </div>

          <div class="seal-gen-presets-card">
            <h3><i class="fas fa-clone"></i> 预设模板</h3>
            <div class="seal-gen-presets-grid">
              <div class="seal-gen-preset" data-preset="official" tabindex="0">
                <span>标准公章</span>
              </div>
              <div class="seal-gen-preset" data-preset="finance" tabindex="0">
                <span>财务专用章</span>
              </div>
              <div class="seal-gen-preset" data-preset="invoice" tabindex="0">
                <span>发票专用章</span>
              </div>
              <div class="seal-gen-preset" data-preset="contract" tabindex="0">
                <span>合同专用章</span>
              </div>
              <div class="seal-gen-preset" data-preset="legal" tabindex="0">
                <span>法人章</span>
              </div>
              <div class="seal-gen-preset" data-preset="project" tabindex="0">
                <span>项目专用章</span>
              </div>
              <div
                class="seal-gen-preset"
                data-preset="realcompany"
                tabindex="0"
              >
                <span>真实公司章</span>
              </div>
              <div
                class="seal-gen-preset"
                data-preset="realbranch"
                tabindex="0"
              >
                <span>真实分公司章</span>
              </div>
              <div class="seal-gen-preset" data-preset="custom" tabindex="0">
                <span>自定义章</span>
              </div>
            </div>
            <div class="seal-gen-presets-tip">
              点击上方模板可一键应用常用印章样式
            </div>
          </div>

          <!-- 效果与输出 -->
          <div class="seal-gen-control-card">
            <h3><i class="fas fa-magic"></i> 效果与输出</h3>
            <div class="seal-gen-effect-options">
              <div class="seal-gen-effect-option active" data-effect="texture">
                <i class="fas fa-texture"></i>
                <span>纸张纹理</span>
              </div>
              <div class="seal-gen-effect-option" data-effect="ink">
                <i class="fas fa-tint"></i>
                <span>墨迹效果</span>
              </div>
              <div class="seal-gen-effect-option" data-effect="distress">
                <i class="fas fa-cut"></i>
                <span>边缘磨损</span>
              </div>
              <div class="seal-gen-effect-option" data-effect="shadow">
                <i class="fas fa-cloud"></i>
                <span>阴影效果</span>
              </div>
              <div class="seal-gen-effect-option" data-effect="noise">
                <i class="fas fa-bahai"></i>
                <span>噪点效果</span>
              </div>
            </div>

            <div class="seal-gen-form-group">
              <label>效果强度</label>
              <input
                type="range"
                id="effectIntensity"
                class="seal-gen-form-control"
                min="0"
                max="100"
                value="50"
              />
              <span class="seal-gen-range-value" id="effectIntensityValue"
                >50</span
              >%
            </div>

            <div class="seal-gen-form-group">
              <label>输出尺寸</label>
              <select id="outputSize" class="seal-gen-form-control">
                <option value="400">400×400px</option>
                <option value="600">600×600px</option>
                <option value="800">800×800px</option>
                <option value="1000">1000×1000px</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label>输出格式</label>
              <select id="outputFormat" class="seal-gen-form-control">
                <option value="png">PNG</option>
                <option value="jpg">JPG</option>
                <option value="svg">SVG</option>
              </select>
            </div>

            <div class="seal-gen-form-group">
              <label>上传预览背景图片</label>
              <input
                type="file"
                id="previewBackground"
                class="seal-gen-form-control"
                accept="image/*"
              />
            </div>

            <div class="seal-gen-action-buttons">
              <button
                class="seal-gen-btn seal-gen-btn-primary"
                id="generateBtn"
              >
                <i class="fas fa-sync-alt"></i> 重新生成
              </button>
              <button
                class="seal-gen-btn seal-gen-btn-success"
                id="downloadBtn"
              >
                <i class="fas fa-download"></i> 下载印章
              </button>
              <button class="seal-gen-btn seal-gen-btn-reset" id="resetBtn">
                <i class="fas fa-redo"></i> 重置
              </button>
              <button class="seal-gen-btn seal-gen-btn-info" id="saveBtn">
                <i class="fas fa-save"></i> 保存设置
              </button>
              <button class="seal-gen-btn seal-gen-btn-info" id="loadBtn">
                <i class="fas fa-upload"></i> 加载设置
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <style>
      .seal-gen-container {
        padding: 15px;
      }

      .seal-gen-generator-container {
        display: flex;
        gap: 15px;
        max-width: 1400px;
        margin: 0 auto;
      }

      .seal-gen-controls-section {
        flex: 1;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }

      .seal-gen-preview-section {
        flex: 0 0 400px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .seal-gen-control-card,
      .seal-gen-preview-card,
      .seal-gen-presets-card {
        background: white;
        border-radius: 6px;
        padding: 15px;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
      }

      .seal-gen-control-card h3,
      .seal-gen-preview-card h3,
      .seal-gen-presets-card h3 {
        margin-top: 0;
        margin-bottom: 12px;
        font-size: 15px;
        color: #333;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .seal-gen-form-group {
        margin-bottom: 12px;
      }

      .seal-gen-form-group label {
        display: block;
        margin-bottom: 4px;
        font-size: 13px;
        color: #666;
      }

      .seal-gen-form-control {
        width: 100%;
        padding: 6px 10px;
        border: 1px solid #ddd;
        border-radius: 3px;
        background-color: #fff;
        font-size: 13px;
      }

      .seal-gen-range-value {
        display: inline-block;
        margin-left: 4px;
        font-size: 13px;
        color: #333;
      }

      .seal-gen-effect-options {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-bottom: 12px;
      }

      .seal-gen-effect-option {
        flex: 1 0 calc(50% - 3px);
        text-align: center;
        padding: 6px 4px;
        border: 1px solid #ddd;
        border-radius: 3px;
        cursor: pointer;
        transition: all 0.3s;
        min-width: 70px;
        font-size: 12px;
      }

      .seal-gen-effect-option.active {
        border-color: #cc0000;
        background-color: #ffeeee;
      }

      .seal-gen-effect-option i {
        font-size: 14px;
        color: #666;
        display: block;
        margin-bottom: 2px;
      }

      .seal-gen-effect-option.active i {
        color: #cc0000;
      }

      .seal-gen-action-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 15px;
      }

      .seal-gen-btn {
        padding: 6px 12px;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        font-size: 13px;
        transition: all 0.2s;
        flex: 1 0 auto;
        min-width: 70px;
      }

      .seal-gen-btn-sm {
        padding: 4px 8px;
        font-size: 12px;
      }

      .seal-gen-btn-primary {
        background-color: #cc0000;
        color: white;
      }

      .seal-gen-btn-success {
        background-color: #28a745;
        color: white;
      }

      .seal-gen-btn-reset {
        background-color: #6c757d;
        color: white;
      }

      .seal-gen-btn-info {
        background-color: #17a2b8;
        color: white;
      }

      .seal-gen-btn:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }

      .seal-gen-canvas-container {
        background: #f9f9f9;
        border: 1px solid #eee;
        border-radius: 3px;
        padding: 8px;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 380px;
        margin-bottom: 8px;
        position: relative;
      }

      .seal-gen-canvas-container img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: 0;
      }

      .seal-gen-canvas-container canvas {
        z-index: 1;
      }

      .seal-gen-preview-actions {
        display: flex;
        gap: 6px;
        justify-content: center;
      }

      .seal-gen-presets-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 6px;
      }

      .seal-gen-preset {
        border: 1.5px solid #eee;
        border-radius: 3px;
        padding: 6px 4px;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 12px;
        background: #fafbfc;
        outline: none;
        user-select: none;
      }
      .seal-gen-preset:hover,
      .seal-gen-preset:focus {
        border-color: #cc0000;
        background-color: #ffeeee;
        color: #cc0000;
      }
      .seal-gen-preset.selected {
        border-color: #cc0000;
        background-color: #fff0f0;
        color: #cc0000;
        font-weight: bold;
        box-shadow: 0 0 0 2px #cc000033;
      }
      .seal-gen-presets-tip {
        margin-top: 6px;
        font-size: 12px;
        color: #888;
        text-align: center;
      }

      .seal-gen-preset-preview {
        width: 100%;
        height: 60px;
        background-color: #f5f5f5;
        margin-bottom: 5px;
        border-radius: 3px;
      }

      input[type="range"].seal-gen-form-control {
        padding: 0;
        height: auto;
      }

      #customAntiCounterfeitGroup,
      #antiCounterfeitArcGroup,
      #antiCounterfeitSpacingGroup {
        display: none;
      }

      .seal-gen-form-group input[type="checkbox"] {
        margin-right: 5px;
      }

      .seal-gen-form-group label input[type="checkbox"] {
        margin-right: 8px;
        vertical-align: middle;
      }

      @media (max-width: 1200px) {
        .seal-gen-generator-container {
          flex-direction: column;
        }

        .seal-gen-preview-section {
          flex: 0 0 auto;
        }

        .seal-gen-controls-section {
          grid-template-columns: repeat(2, 1fr);
          gap: 12px;
        }
      }

      @media (max-width: 768px) {
        .seal-gen-controls-section {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .seal-gen-control-card,
        .seal-gen-preview-card,
        .seal-gen-presets-card {
          padding: 12px;
        }

        .seal-gen-form-group {
          margin-bottom: 10px;
        }

        .seal-gen-btn {
          padding: 5px 10px;
          font-size: 12px;
          min-width: 60px;
        }

        .seal-gen-effect-option {
          padding: 5px 3px;
          min-width: 60px;
          font-size: 11px;
        }

        .seal-gen-preset {
          padding: 5px 3px;
          font-size: 11px;
        }
      }
      body.seal-night {
        background: #181a20 !important;
        color: #eee !important;
      }

      .seal-night .seal-gen-control-card,
      .seal-night .seal-gen-preview-card,
      .seal-night .seal-gen-presets-card {
        background: #23262f !important;
        color: #eee !important;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }
      .seal-night .seal-gen-control-card h3,
      .seal-night .seal-gen-preview-card h3,
      .seal-night .seal-gen-presets-card h3 {
        color: #fff !important;
      }
      .seal-night .seal-gen-form-control {
        background: #23262f !important;
        color: #eee !important;
        border-color: #444 !important;
      }
      .seal-night .seal-gen-btn {
        background: #23262f !important;
        color: #ff4d4f !important;
        border: 1px solid #444 !important;
      }
      .seal-night .seal-gen-btn-primary {
        background: #ff4d4f !important;
        color: #fff !important;
      }
      .seal-night .seal-gen-btn-success {
        background: #28a745 !important;
        color: #fff !important;
      }
      .seal-night .seal-gen-btn-reset {
        background: #6c757d !important;
        color: #fff !important;
      }
      .seal-night .seal-gen-btn-info {
        background: #17a2b8 !important;
        color: #fff !important;
      }
      .seal-night .seal-gen-effect-option {
        background: #23262f !important;
        color: #eee !important;
        border-color: #444 !important;
      }
      .seal-night .seal-gen-effect-option.active {
        background: #2d2f3a !important;
        color: #ff4d4f !important;
        border-color: #ff4d4f !important;
      }
      .seal-night .seal-gen-preset {
        background: #23262f !important;
        color: #eee !important;
        border-color: #444 !important;
      }
      .seal-night .seal-gen-preset.selected {
        background: #2d2f3a !important;
        color: #ff4d4f !important;
        border-color: #ff4d4f !important;
      }
      .seal-night .seal-gen-presets-tip {
        color: #aaa !important;
      }
      .seal-night .seal-gen-canvas-container {
        background: #23262f !important;
        border-color: #444 !important;
      }
      .seal-gen-control-card h3 i,
      .seal-gen-preview-card h3 i,
      .seal-gen-presets-card h3 i {
        font-size: 14px;
      }
    </style>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // 预设模板
        const presets = {
          official: {
            sealType: "circle",
            mainText: "示例有限公司",
            subText: "公章",
            mainTextColor: "#cc0000",
            subTextColor: "#cc0000",
            sealColor: "#cc0000",
            borderStyle: "double",
            centerPattern: "star",
            padding: "0",
            mainLetterSpacing: "5",
            mainTextDirection: "clockwise",
            mainBold: false,
            mainItalic: false,
            subFontSize: "18",
            mainTextOffset: "0",
            mainTextStartAngle: "144",
            subTextOffset: "0",
            subTextStartAngle: "270",
            subTextCurve: "0",
            subLetterSpacing: "2",
            subTextDirection: "clockwise",
            subBold: false,
            subItalic: false,
            enableAntiCounterfeit: true,
            antiCounterfeitType: "auto",
            antiCounterfeitPosition: "arc-bottom",
            antiCounterfeitSize: "10",
            antiCounterfeitColor: "#666666",
            antiCounterfeitOpacity: "60",
            antiCounterfeitDirection: "counterclockwise",
            antiCounterfeitOrder: "normal",
          },
          finance: {
            sealType: "ellipse",
            mainText: "示例有限公司",
            subText: "财务专用章",
            mainTextColor: "#cc0000",
            subTextColor: "#cc0000",
            sealColor: "#cc0000",
            borderStyle: "double",
            centerPattern: "none",
            padding: "0",
            mainLetterSpacing: "5",
            mainTextDirection: "clockwise",
            mainBold: false,
            mainItalic: false,
            subFontSize: "18",
            mainTextOffset: "0",
            mainTextStartAngle: "144",
            subTextOffset: "0",
            subTextStartAngle: "270",
            subTextCurve: "40",
            subLetterSpacing: "3",
            subTextDirection: "clockwise",
            subBold: false,
            subItalic: false,
            enableAntiCounterfeit: true,
            antiCounterfeitType: "timestamp",
            antiCounterfeitPosition: "bottom",
            antiCounterfeitSize: "8",
            antiCounterfeitColor: "#999999",
            antiCounterfeitOpacity: "50",
            antiCounterfeitDirection: "horizontal",
            antiCounterfeitOrder: "normal",
          },
          invoice: {
            sealType: "ellipse",
            mainText: "示例有限公司",
            subText: "发票专用章",
            mainTextColor: "#cc0000",
            subTextColor: "#cc0000",
            sealColor: "#cc0000",
            borderStyle: "single",
            centerPattern: "none",
            padding: "0",
            mainLetterSpacing: "5",
            mainTextDirection: "clockwise",
            mainBold: false,
            mainItalic: false,
            subFontSize: "18",
            mainTextOffset: "0",
            mainTextStartAngle: "144",
            subTextOffset: "0",
            subTextStartAngle: "270",
            subTextCurve: "50",
            subLetterSpacing: "3",
            subTextDirection: "counterclockwise",
            subBold: false,
            subItalic: false,
            enableAntiCounterfeit: true,
            antiCounterfeitType: "uuid",
            antiCounterfeitPosition: "arc-top",
            antiCounterfeitSize: "9",
            antiCounterfeitColor: "#777777",
            antiCounterfeitOpacity: "55",
            antiCounterfeitDirection: "clockwise",
            antiCounterfeitOrder: "normal",
          },
          contract: {
            sealType: "square",
            mainText: "示例有限公司",
            subText: "合同专用章",
            mainTextColor: "#cc0000",
            subTextColor: "#cc0000",
            sealColor: "#cc0000",
            borderStyle: "single",
            centerPattern: "none",
            padding: "0",
            mainLetterSpacing: "5",
            mainTextDirection: "clockwise",
            mainBold: false,
            mainItalic: false,
            subFontSize: "18",
            mainTextOffset: "0",
            mainTextStartAngle: "144",
            subTextOffset: "0",
            subTextStartAngle: "270",
            subTextCurve: "0",
            subLetterSpacing: "2",
            subTextDirection: "clockwise",
            subBold: false,
            subItalic: false,
          },
          legal: {
            sealType: "circle",
            mainText: "张三",
            subText: "法人章",
            mainTextColor: "#cc0000",
            subTextColor: "#cc0000",
            sealColor: "#cc0000",
            borderStyle: "double",
            centerPattern: "star",
            padding: "0",
            mainLetterSpacing: "15",
            mainTextDirection: "clockwise",
            mainBold: false,
            mainItalic: false,
            subFontSize: "18",
            mainTextCurve: "30",
            mainTextOffset: "0",
            mainTextStartAngle: "144",
            subTextOffset: "0",
            subTextStartAngle: "270",
            subTextCurve: "30",
            subLetterSpacing: "8",
            subTextDirection: "counterclockwise",
            subBold: false,
            subItalic: false,
            enableAntiCounterfeit: false,
            antiCounterfeitDirection: "counterclockwise",
            antiCounterfeitOrder: "normal",
          },
          project: {
            sealType: "ellipse",
            mainText: "示例有限公司",
            subText: "项目专用章",
            mainTextColor: "#cc0000",
            subTextColor: "#cc0000",
            sealColor: "#cc0000",
            borderStyle: "dashed",
            centerPattern: "none",
            padding: "0",
            mainLetterSpacing: "5",
            mainTextDirection: "clockwise",
            mainBold: false,
            mainItalic: false,
            subFontSize: "18",
            mainTextOffset: "0",
            mainTextStartAngle: "144",
            subTextOffset: "0",
            subTextStartAngle: "270",
            subTextCurve: "35",
            subLetterSpacing: "2",
            subTextDirection: "clockwise",
            subBold: false,
            subItalic: false,
            enableAntiCounterfeit: false,
            antiCounterfeitDirection: "counterclockwise",
            antiCounterfeitOrder: "normal",
          },
          custom: {
            sealType: "triangle",
            mainText: "示例有限公司",
            subText: "自定义章",
            mainTextColor: "#cc0000",
            subTextColor: "#cc0000",
            sealColor: "#cc0000",
            borderStyle: "dotted",
            centerPattern: "triangle",
            padding: "0",
            mainLetterSpacing: "5",
            mainTextDirection: "clockwise",
            mainBold: false,
            mainItalic: false,
            subFontSize: "18",
            mainTextOffset: "0",
            mainTextStartAngle: "144",
            subTextOffset: "0",
            subTextStartAngle: "270",
            subTextCurve: "0",
            subLetterSpacing: "2",
            subTextDirection: "clockwise",
            subBold: false,
            subItalic: false,
            enableAntiCounterfeit: false,
            antiCounterfeitDirection: "counterclockwise",
            antiCounterfeitOrder: "normal",
          },
          realcompany: {
            sealType: "circle",
            mainText: "上海轻工具科技有限公司",
            subText: "",
            mainTextColor: "#cc0000",
            subTextColor: "#cc0000",
            sealColor: "#cc0000",
            borderStyle: "double",
            borderWidth: "4",
            centerPattern: "star",
            patternSize: "25",
            padding: "5",
            mainLetterSpacing: "3",
            mainTextDirection: "clockwise",
            mainBold: true,
            mainItalic: false,
            subFontSize: "16",
            mainTextCurve: "60",
            mainTextOffset: "-5",
            subTextOffset: "0",
            subTextCurve: "0",
            subLetterSpacing: "2",
            subTextDirection: "clockwise",
            subBold: false,
            subItalic: false,
            enableAntiCounterfeit: true,
            antiCounterfeitType: "auto",
            antiCounterfeitPosition: "bottom",
            antiCounterfeitSize: "8",
            antiCounterfeitColor: "#888888",
            antiCounterfeitOpacity: "45",
            antiCounterfeitOffsetY: "15",
            antiCounterfeitDirection: "horizontal",
            antiCounterfeitOrder: "normal",
          },
          realbranch: {
            sealType: "circle",
            mainText: "上海轻工具科技有限公司浦东分公司",
            subText: "",
            mainTextColor: "#cc0000",
            subTextColor: "#cc0000",
            sealColor: "#cc0000",
            borderStyle: "double",
            borderWidth: "3",
            centerPattern: "star",
            patternSize: "20",
            padding: "3",
            mainLetterSpacing: "1",
            mainTextDirection: "clockwise",
            mainBold: true,
            mainItalic: false,
            subFontSize: "14",
            mainTextCurve: "70",
            mainTextOffset: "-8",
            subTextOffset: "0",
            subTextCurve: "0",
            subLetterSpacing: "2",
            subTextDirection: "clockwise",
            subBold: false,
            subItalic: false,
            enableAntiCounterfeit: true,
            antiCounterfeitType: "timestamp",
            antiCounterfeitPosition: "arc-bottom",
            antiCounterfeitSize: "7",
            antiCounterfeitColor: "#999999",
            antiCounterfeitOpacity: "40",
            antiCounterfeitCurve: "20",
            antiCounterfeitSpacing: "1",
            antiCounterfeitDirection: "counterclockwise",
            antiCounterfeitOrder: "normal",
          },
        };

        // 变量声明
        const canvas = document.getElementById("sealCanvas");
        const ctx = canvas.getContext("2d");
        let activeEffects = ["texture"];
        let zoomLevel = 1;
        let rotationAngle = 0;
        let customImage = null;
        let previewBgImage = null;

        // 滑块值联动显示
        function updateSliderValue(sliderId, valueId) {
          const slider = document.getElementById(sliderId);
          const valueDisplay = document.getElementById(valueId);
          if (slider && valueDisplay) {
            valueDisplay.textContent = slider.value;
            slider.addEventListener("input", function () {
              valueDisplay.textContent = this.value;
              drawSeal();
            });
          }
        }
        updateSliderValue("mainFontSize", "mainFontSizeValue");
        updateSliderValue("mainLetterSpacing", "mainLetterSpacingValue");
        updateSliderValue("mainTextCurve", "mainTextCurveValue");
        updateSliderValue("borderWidth", "borderWidthValue");
        updateSliderValue("padding", "paddingValue");
        updateSliderValue("patternSize", "patternSizeValue");
        updateSliderValue("patternOffsetX", "patternOffsetXValue");
        updateSliderValue("patternOffsetY", "patternOffsetYValue");
        updateSliderValue("effectIntensity", "effectIntensityValue");
        updateSliderValue("subFontSize", "subFontSizeValue");
        updateSliderValue("mainTextOffset", "mainTextOffsetValue");
        updateSliderValue("mainTextStartAngle", "mainTextStartAngleValue");
        updateSliderValue("subTextOffset", "subTextOffsetValue");
        updateSliderValue("subTextStartAngle", "subTextStartAngleValue");
        updateSliderValue("subTextCurve", "subTextCurveValue");
        updateSliderValue("subLetterSpacing", "subLetterSpacingValue");
        updateSliderValue("antiCounterfeitSize", "antiCounterfeitSizeValue");
        updateSliderValue(
          "antiCounterfeitOffsetX",
          "antiCounterfeitOffsetXValue"
        );
        updateSliderValue(
          "antiCounterfeitOffsetY",
          "antiCounterfeitOffsetYValue"
        );
        updateSliderValue("antiCounterfeitCurve", "antiCounterfeitCurveValue");
        updateSliderValue(
          "antiCounterfeitSpacing",
          "antiCounterfeitSpacingValue"
        );
        updateSliderValue(
          "antiCounterfeitOpacity",
          "antiCounterfeitOpacityValue"
        );

        // 效果选择
        document
          .querySelectorAll(".seal-gen-effect-option")
          .forEach((option) => {
            option.addEventListener("click", function () {
              const effect = this.getAttribute("data-effect");
              if (this.classList.contains("active")) {
                this.classList.remove("active");
                activeEffects = activeEffects.filter((e) => e !== effect);
              } else {
                this.classList.add("active");
                if (!activeEffects.includes(effect)) activeEffects.push(effect);
              }
              drawSeal();
            });
          });

        // 防伪码控制
        const enableAntiCounterfeitCheckbox = document.getElementById(
          "enableAntiCounterfeit"
        );
        const antiCounterfeitTypeSelect = document.getElementById(
          "antiCounterfeitType"
        );
        const customAntiCounterfeitGroup = document.getElementById(
          "customAntiCounterfeitGroup"
        );
        const antiCounterfeitPositionSelect = document.getElementById(
          "antiCounterfeitPosition"
        );
        const antiCounterfeitArcGroup = document.getElementById(
          "antiCounterfeitArcGroup"
        );
        const antiCounterfeitSpacingGroup = document.getElementById(
          "antiCounterfeitSpacingGroup"
        );

        // 防伪码类型切换
        function updateAntiCounterfeitVisibility() {
          const isEnabled = enableAntiCounterfeitCheckbox.checked;
          const type = antiCounterfeitTypeSelect.value;
          const position = antiCounterfeitPositionSelect.value;

          customAntiCounterfeitGroup.style.display =
            isEnabled && type === "custom" ? "block" : "none";
          antiCounterfeitArcGroup.style.display =
            isEnabled && (position === "arc-bottom" || position === "arc-top")
              ? "block"
              : "none";
          antiCounterfeitSpacingGroup.style.display =
            isEnabled && (position === "arc-bottom" || position === "arc-top")
              ? "block"
              : "none";
        }

        enableAntiCounterfeitCheckbox.addEventListener("change", function () {
          updateAntiCounterfeitVisibility();
          drawSeal();
        });

        antiCounterfeitTypeSelect.addEventListener("change", function () {
          updateAntiCounterfeitVisibility();
          generateAntiCounterfeitCode();
        });

        antiCounterfeitPositionSelect.addEventListener("change", function () {
          updateAntiCounterfeitVisibility();
          drawSeal();
        });

        // 生成防伪码
        function generateAntiCounterfeitCode() {
          const type = antiCounterfeitTypeSelect.value;
          let code = "";

          switch (type) {
            case "auto":
              code = Math.random().toString(36).substr(2, 8).toUpperCase();
              break;
            case "timestamp":
              const now = new Date();
              code =
                now.getFullYear().toString() +
                (now.getMonth() + 1).toString().padStart(2, "0") +
                now.getDate().toString().padStart(2, "0") +
                now.getHours().toString().padStart(2, "0") +
                now.getMinutes().toString().padStart(2, "0");
              break;
            case "uuid":
              code = "xxxx-xxxx-xxxx".replace(/[x]/g, function () {
                return ((Math.random() * 16) | 0).toString(16).toUpperCase();
              });
              break;
            case "custom":
              return; // 不生成，使用用户输入
          }

          document.getElementById("customAntiCounterfeit").value = code;
        }

        // 重新生成防伪码按钮
        document
          .getElementById("generateAntiCounterfeitBtn")
          .addEventListener("click", generateAntiCounterfeitCode);

        // 初始化防伪码显示状态
        updateAntiCounterfeitVisibility();
        generateAntiCounterfeitCode();

        // 预设模板点击
        function selectPreset(presetName) {
          document.querySelectorAll(".seal-gen-preset").forEach((preset) => {
            if (preset.getAttribute("data-preset") === presetName) {
              preset.classList.add("selected");
            } else {
              preset.classList.remove("selected");
            }
          });
        }
        document.querySelectorAll(".seal-gen-preset").forEach((preset) => {
          preset.addEventListener("click", function () {
            const presetName = this.getAttribute("data-preset");
            const preset = presets[presetName];
            for (const key in preset) {
              const element = document.getElementById(key);
              if (element) {
                if (element.type === "checkbox") {
                  element.checked = preset[key];
                } else {
                  element.value = preset[key];
                }
                if (element.type === "range") {
                  const valueId = key + "Value";
                  const valueDisplay = document.getElementById(valueId);
                  if (valueDisplay) valueDisplay.textContent = element.value;
                }
              }
            }
            selectPreset(presetName);
            updateAntiCounterfeitVisibility();
            if (
              preset.antiCounterfeitType &&
              preset.antiCounterfeitType !== "custom"
            ) {
              generateAntiCounterfeitCode();
            }
            drawSeal();
          });
          preset.addEventListener("keydown", function (e) {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              this.click();
            }
          });
        });
        selectPreset("official");

        // 主文字弧度滑块联动
        document
          .getElementById("mainTextCurve")
          .addEventListener("input", function () {
            document.getElementById("mainTextCurveValue").textContent =
              this.value;
            drawSeal();
          });

        // 缩放和旋转控制
        document
          .getElementById("zoomInBtn")
          .addEventListener("click", function () {
            zoomLevel = Math.min(2, zoomLevel + 0.1);
            drawSeal();
          });
        document
          .getElementById("zoomOutBtn")
          .addEventListener("click", function () {
            zoomLevel = Math.max(0.5, zoomLevel - 0.1);
            drawSeal();
          });
        document
          .getElementById("rotateBtn")
          .addEventListener("click", function () {
            rotationAngle = (rotationAngle + 45) % 360;
            drawSeal();
          });

        // 重置按钮
        document
          .getElementById("resetBtn")
          .addEventListener("click", function () {
            document.getElementById("mainText").value = "示例有限公司";
            document.getElementById("subText").value = "";
            document.getElementById("mainTextColor").value = "#cc0000";
            document.getElementById("subTextColor").value = "#cc0000";
            document.getElementById("sealColor").value = "#cc0000";
            document.getElementById("bgColor").value = "#ffffff";
            document.getElementById("transparentBg").checked = false;
            document.getElementById("mainFont").value = "FangSong,仿宋";
            document.getElementById("mainFontSize").value = "24";
            document.getElementById("mainLetterSpacing").value = "5";
            document.getElementById("mainTextCurve").value = "50";
            document.getElementById("mainTextDirection").value = "clockwise";
            document.getElementById("mainBold").checked = false;
            document.getElementById("mainItalic").checked = false;
            document.getElementById("subFont").value = "FangSong,仿宋";
            document.getElementById("subFontSize").value = "18";
            document.getElementById("subTextCurve").value = "0";
            document.getElementById("subLetterSpacing").value = "2";
            document.getElementById("subTextDirection").value = "clockwise";
            document.getElementById("subBold").checked = false;
            document.getElementById("subItalic").checked = false;
            document.getElementById("borderStyle").value = "single";
            document.getElementById("borderWidth").value = "3";
            document.getElementById("padding").value = "0";
            document.getElementById("centerPattern").value = "star";
            document.getElementById("patternSize").value = "40";
            document.getElementById("patternColor").value = "#cc0000";
            document.getElementById("patternOffsetX").value = "0";
            document.getElementById("patternOffsetY").value = "0";
            document.getElementById("effectIntensity").value = "50";
            document.getElementById("mainTextOffset").value = "0";
            document.getElementById("mainTextStartAngle").value = "144";
            document.getElementById("subTextOffset").value = "0";
            document.getElementById("subTextStartAngle").value = "270";
            document.getElementById("outputSize").value = "400";
            document.getElementById("outputFormat").value = "png";
            // 重置防伪码设置
            document.getElementById("enableAntiCounterfeit").checked = false;
            document.getElementById("antiCounterfeitType").value = "auto";
            document.getElementById("customAntiCounterfeit").value = "";
            document.getElementById("antiCounterfeitFont").value =
              "Courier New,monospace";
            document.getElementById("antiCounterfeitSize").value = "10";
            document.getElementById("antiCounterfeitColor").value = "#666666";
            document.getElementById("antiCounterfeitPosition").value =
              "arc-bottom";
            document.getElementById("antiCounterfeitOffsetX").value = "0";
            document.getElementById("antiCounterfeitOffsetY").value = "0";
            document.getElementById("antiCounterfeitCurve").value = "30";
            document.getElementById("antiCounterfeitSpacing").value = "2";
            document.getElementById("antiCounterfeitOpacity").value = "60";
            document.getElementById("antiCounterfeitBold").checked = false;
            document.getElementById("antiCounterfeitDirection").value =
              "counterclockwise";
            document.getElementById("antiCounterfeitOrder").value = "normal";
            updateSliderValue("mainFontSize", "mainFontSizeValue");
            updateSliderValue("mainLetterSpacing", "mainLetterSpacingValue");
            updateSliderValue("mainTextCurve", "mainTextCurveValue");
            updateSliderValue("borderWidth", "borderWidthValue");
            updateSliderValue("padding", "paddingValue");
            updateSliderValue("patternSize", "patternSizeValue");
            updateSliderValue("patternOffsetX", "patternOffsetXValue");
            updateSliderValue("patternOffsetY", "patternOffsetYValue");
            updateSliderValue("effectIntensity", "effectIntensityValue");
            updateSliderValue("subFontSize", "subFontSizeValue");
            updateSliderValue("mainTextOffset", "mainTextOffsetValue");
            updateSliderValue("mainTextStartAngle", "mainTextStartAngleValue");
            updateSliderValue("subTextOffset", "subTextOffsetValue");
            updateSliderValue("subTextStartAngle", "subTextStartAngleValue");
            updateSliderValue("subTextCurve", "subTextCurveValue");
            updateSliderValue("subLetterSpacing", "subLetterSpacingValue");
            // 更新防伪码滑块值显示
            updateSliderValue(
              "antiCounterfeitSize",
              "antiCounterfeitSizeValue"
            );
            updateSliderValue(
              "antiCounterfeitOffsetX",
              "antiCounterfeitOffsetXValue"
            );
            updateSliderValue(
              "antiCounterfeitOffsetY",
              "antiCounterfeitOffsetYValue"
            );
            updateSliderValue(
              "antiCounterfeitCurve",
              "antiCounterfeitCurveValue"
            );
            updateSliderValue(
              "antiCounterfeitSpacing",
              "antiCounterfeitSpacingValue"
            );
            updateSliderValue(
              "antiCounterfeitOpacity",
              "antiCounterfeitOpacityValue"
            );
            document
              .querySelectorAll(".seal-gen-effect-option")
              .forEach((option) => {
                option.classList.remove("active");
              });
            document
              .querySelector('.seal-gen-effect-option[data-effect="texture"]')
              .classList.add("active");
            activeEffects = ["texture"];
            zoomLevel = 1;
            rotationAngle = 0;
            customImage = null;
            previewBgImage = null;
            document.getElementById("customPatternGroup").style.display =
              "none";
            selectPreset("official");
            updateAntiCounterfeitVisibility();
            generateAntiCounterfeitCode();
            drawSeal();
          });

        // 保存设置
        document
          .getElementById("saveBtn")
          .addEventListener("click", function () {
            const settings = {
              sealType: document.getElementById("sealType").value,
              mainText: document.getElementById("mainText").value,
              subText: document.getElementById("subText").value,
              mainTextColor: document.getElementById("mainTextColor").value,
              subTextColor: document.getElementById("subTextColor").value,
              sealColor: document.getElementById("sealColor").value,
              bgColor: document.getElementById("bgColor").value,
              transparentBg: document.getElementById("transparentBg").checked,
              mainFont: document.getElementById("mainFont").value,
              mainFontSize: document.getElementById("mainFontSize").value,
              mainLetterSpacing:
                document.getElementById("mainLetterSpacing").value,
              mainTextCurve: document.getElementById("mainTextCurve").value,
              mainTextDirection:
                document.getElementById("mainTextDirection").value,
              mainBold: document.getElementById("mainBold").checked,
              mainItalic: document.getElementById("mainItalic").checked,
              subFont: document.getElementById("subFont").value,
              subFontSize: document.getElementById("subFontSize").value,
              subTextCurve: document.getElementById("subTextCurve").value,
              subLetterSpacing:
                document.getElementById("subLetterSpacing").value,
              subTextDirection:
                document.getElementById("subTextDirection").value,
              subBold: document.getElementById("subBold").checked,
              subItalic: document.getElementById("subItalic").checked,
              borderStyle: document.getElementById("borderStyle").value,
              borderWidth: document.getElementById("borderWidth").value,
              padding: document.getElementById("padding").value,
              centerPattern: document.getElementById("centerPattern").value,
              patternSize: document.getElementById("patternSize").value,
              patternColor: document.getElementById("patternColor").value,
              patternOffsetX: document.getElementById("patternOffsetX").value,
              patternOffsetY: document.getElementById("patternOffsetY").value,
              effectIntensity: document.getElementById("effectIntensity").value,
              outputSize: document.getElementById("outputSize").value,
              outputFormat: document.getElementById("outputFormat").value,
              activeEffects: activeEffects,
              // 防伪码设置
              enableAntiCounterfeit: document.getElementById(
                "enableAntiCounterfeit"
              ).checked,
              antiCounterfeitType: document.getElementById(
                "antiCounterfeitType"
              ).value,
              customAntiCounterfeit: document.getElementById(
                "customAntiCounterfeit"
              ).value,
              antiCounterfeitFont: document.getElementById(
                "antiCounterfeitFont"
              ).value,
              antiCounterfeitSize: document.getElementById(
                "antiCounterfeitSize"
              ).value,
              antiCounterfeitColor: document.getElementById(
                "antiCounterfeitColor"
              ).value,
              antiCounterfeitPosition: document.getElementById(
                "antiCounterfeitPosition"
              ).value,
              antiCounterfeitOffsetX: document.getElementById(
                "antiCounterfeitOffsetX"
              ).value,
              antiCounterfeitOffsetY: document.getElementById(
                "antiCounterfeitOffsetY"
              ).value,
              antiCounterfeitCurve: document.getElementById(
                "antiCounterfeitCurve"
              ).value,
              antiCounterfeitSpacing: document.getElementById(
                "antiCounterfeitSpacing"
              ).value,
              antiCounterfeitOpacity: document.getElementById(
                "antiCounterfeitOpacity"
              ).value,
              antiCounterfeitBold: document.getElementById(
                "antiCounterfeitBold"
              ).checked,
              antiCounterfeitDirection: document.getElementById(
                "antiCounterfeitDirection"
              ).value,
              antiCounterfeitOrder: document.getElementById(
                "antiCounterfeitOrder"
              ).value,
            };
            localStorage.setItem("sealSettings", JSON.stringify(settings));
            alert("设置已保存");
          });

        // 加载设置
        document
          .getElementById("loadBtn")
          .addEventListener("click", function () {
            const savedSettings = localStorage.getItem("sealSettings");
            if (savedSettings) {
              const settings = JSON.parse(savedSettings);
              for (const key in settings) {
                const element = document.getElementById(key);
                if (element) {
                  if (element.type === "checkbox") {
                    element.checked = settings[key];
                  } else {
                    element.value = settings[key];
                  }
                  if (element.type === "range") {
                    const valueId = key + "Value";
                    const valueDisplay = document.getElementById(valueId);
                    if (valueDisplay) valueDisplay.textContent = element.value;
                  }
                }
              }
              activeEffects = settings.activeEffects;
              document
                .querySelectorAll(".seal-gen-effect-option")
                .forEach((option) => {
                  option.classList.remove("active");
                });
              activeEffects.forEach((effect) => {
                document
                  .querySelector(
                    `.seal-gen-effect-option[data-effect="${effect}"]`
                  )
                  .classList.add("active");
              });
              updateAntiCounterfeitVisibility();
              drawSeal();
              alert("设置已加载");
            } else {
              alert("没有保存的设置");
            }
          });

        // 下载按钮
        document
          .getElementById("downloadBtn")
          .addEventListener("click", function () {
            const format = document.getElementById("outputFormat").value;
            let mimeType, extension;
            switch (format) {
              case "jpg":
                mimeType = "image/jpeg";
                extension = "jpg";
                break;
              case "svg":
                alert("SVG格式暂不支持，将导出PNG格式");
                mimeType = "image/png";
                extension = "png";
                break;
              default:
                mimeType = "image/png";
                extension = "png";
            }
            const link = document.createElement("a");
            link.download = `公司印章.${extension}`;
            link.href = canvas.toDataURL(mimeType);
            link.click();
          });

        // 生成按钮
        document
          .getElementById("generateBtn")
          .addEventListener("click", drawSeal);

        // 输入变化时自动更新
        const inputs = document.querySelectorAll("input, select, textarea");
        inputs.forEach((input) => {
          input.addEventListener("change", drawSeal);
          input.addEventListener("input", drawSeal);
        });

        // 自定义图案处理
        const centerPatternSelect = document.getElementById("centerPattern");
        centerPatternSelect.addEventListener("change", function () {
          document.getElementById("customPatternGroup").style.display =
            this.value === "custom" ? "block" : "none";
          drawSeal();
        });

        const customPatternInput = document.getElementById("customPattern");
        customPatternInput.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (ev) {
              customImage = new Image();
              customImage.src = ev.target.result;
              customImage.onload = drawSeal;
            };
            reader.readAsDataURL(file);
          }
        });

        // 预览背景图片
        const previewBackgroundInput =
          document.getElementById("previewBackground");
        previewBackgroundInput.addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (ev) {
              previewBgImage = new Image();
              previewBgImage.src = ev.target.result;
              previewBgImage.onload = drawSeal;
            };
            reader.readAsDataURL(file);
          } else {
            previewBgImage = null;
            drawSeal();
          }
        });

        // 绘制弧形文字
        function drawArcText(
          ctx,
          text,
          centerX,
          centerY,
          radius,
          startAngle,
          endAngle,
          options = {}
        ) {
          const {
            fontSize = 24,
            fontFamily = "FangSong,仿宋",
            color = "#cc0000",
            letterSpacing = 0,
            align = "center",
            curve = 50,
            direction = "clockwise",
            bold = false,
            italic = false,
          } = options;

          ctx.save();
          ctx.font = `${bold ? "bold " : ""}${
            italic ? "italic " : ""
          }${fontSize}px ${fontFamily}`;
          ctx.fillStyle = color;
          ctx.textAlign = align;
          ctx.textBaseline = "middle";

          const chars = text.split("");
          const curvePercent = curve / 100;
          const totalAngle = (endAngle - startAngle) * curvePercent;
          const spacingAngle = letterSpacing * 0.01;
          const totalSpacing = spacingAngle * (chars.length - 1);
          const adjustedTotalAngle = Math.min(
            totalAngle + totalSpacing,
            Math.PI * 1.4
          );

          let baseAngle = startAngle + (totalAngle - adjustedTotalAngle) / 2;
          let angleStep =
            chars.length > 1 ? adjustedTotalAngle / (chars.length - 1) : 0;

          if (direction === "counterclockwise") {
            baseAngle =
              startAngle + totalAngle - (totalAngle - adjustedTotalAngle) / 2;
            angleStep = -angleStep;
          }

          chars.forEach((char, i) => {
            const angle = baseAngle + angleStep * i;
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle + Math.PI / 2);
            ctx.fillText(char, 0, 0);
            ctx.restore();
          });

          ctx.restore();
        }

        // 绘制五角星
        function drawStar(ctx, cx, cy, radius, color) {
          ctx.beginPath();
          for (let i = 0; i < 5; i++) {
            const angle = (i * 2 * Math.PI) / 5 - Math.PI / 2;
            const x = cx + radius * Math.cos(angle);
            const y = cy + radius * Math.sin(angle);
            if (i === 0) {
              ctx.moveTo(x, y);
            } else {
              ctx.lineTo(x, y);
            }
            const innerAngle = angle + Math.PI / 5;
            const innerX = cx + (radius / 2) * Math.cos(innerAngle);
            const innerY = cy + (radius / 2) * Math.sin(innerAngle);
            ctx.lineTo(innerX, innerY);
          }
          ctx.closePath();
          ctx.fillStyle = color;
          ctx.fill();
        }

        // 绘制三角形
        function drawTriangle(ctx, cx, cy, side, color, isFill = true) {
          const height = (side * Math.sqrt(3)) / 2;
          ctx.beginPath();
          ctx.moveTo(cx, cy - height / 2);
          ctx.lineTo(cx - side / 2, cy + height / 2);
          ctx.lineTo(cx + side / 2, cy + height / 2);
          ctx.closePath();
          ctx.fillStyle = color;
          if (isFill) {
            ctx.fill();
          } else {
            ctx.strokeStyle = color;
            ctx.stroke();
          }
        }

        // 绘制防伪码
        function drawAntiCounterfeitCode(
          ctx,
          centerX,
          centerY,
          sealSize,
          sealType
        ) {
          const isEnabled = document.getElementById(
            "enableAntiCounterfeit"
          ).checked;
          if (!isEnabled) return;

          const type = document.getElementById("antiCounterfeitType").value;
          let code = "";

          if (type === "custom") {
            code = document.getElementById("customAntiCounterfeit").value;
          } else {
            code =
              document.getElementById("customAntiCounterfeit").value ||
              "AC-" + Math.random().toString(36).substr(2, 6).toUpperCase();
          }

          if (!code) return;

          const fontSize = parseInt(
            document.getElementById("antiCounterfeitSize").value
          );
          const fontFamily = document.getElementById(
            "antiCounterfeitFont"
          ).value;
          const color = document.getElementById("antiCounterfeitColor").value;
          const position = document.getElementById(
            "antiCounterfeitPosition"
          ).value;
          const offsetX = parseInt(
            document.getElementById("antiCounterfeitOffsetX").value
          );
          const offsetY = parseInt(
            document.getElementById("antiCounterfeitOffsetY").value
          );
          const opacity =
            parseInt(document.getElementById("antiCounterfeitOpacity").value) /
            100;
          const isBold = document.getElementById("antiCounterfeitBold").checked;
          const curve = parseInt(
            document.getElementById("antiCounterfeitCurve").value
          );
          const spacing = parseInt(
            document.getElementById("antiCounterfeitSpacing").value
          );
          const direction =
            document.getElementById("antiCounterfeitDirection").value ||
            "horizontal";
          const order =
            document.getElementById("antiCounterfeitOrder").value || "normal";

          // 根据顺序调整防伪码
          if (order === "reverse") {
            code = code.split("").reverse().join("");
          }

          ctx.save();
          ctx.globalAlpha = opacity;
          ctx.font = `${isBold ? "bold " : ""}${fontSize}px ${fontFamily}`;
          ctx.fillStyle = color;
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";

          let x = centerX + offsetX;
          let y = centerY + offsetY;

          // 根据方向调整绘制
          switch (position) {
            case "top":
              y = centerY - sealSize / 3 + offsetY;
              if (direction === "vertical") {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText(code, 0, 0);
                ctx.restore();
              } else {
                ctx.fillText(code, x, y);
              }
              break;
            case "bottom":
              y = centerY + sealSize / 3 + offsetY;
              if (direction === "vertical") {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(Math.PI / 2);
                ctx.fillText(code, 0, 0);
                ctx.restore();
              } else {
                ctx.fillText(code, x, y);
              }
              break;
            case "left":
              x = centerX - sealSize / 3 + offsetX;
              if (direction === "horizontal") {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(-Math.PI / 2);
                ctx.fillText(code, 0, 0);
                ctx.restore();
              } else {
                ctx.fillText(code, x, y);
              }
              break;
            case "right":
              x = centerX + sealSize / 3 + offsetX;
              if (direction === "horizontal") {
                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(Math.PI / 2);
                ctx.fillText(code, 0, 0);
                ctx.restore();
              } else {
                ctx.fillText(code, x, y);
              }
              break;
            case "center":
              ctx.fillText(code, x, y);
              break;
            case "arc-bottom":
              const bottomRadius =
                sealType === "ellipse" || sealType === "invoice"
                  ? sealSize / 2 - 60
                  : sealSize / 2 - 50;
              // 获取用户设置的防伪码方向
              let bottomDirection = direction;
              // 如果方向是水平或垂直，使用默认逆时针
              if (direction === "horizontal" || direction === "vertical") {
                bottomDirection = "counterclockwise";
              }
              drawArcText(
                ctx,
                code,
                centerX + offsetX,
                centerY + offsetY,
                bottomRadius,
                Math.PI * 0.3,
                Math.PI * 0.7,
                {
                  fontSize,
                  fontFamily,
                  color,
                  letterSpacing: spacing,
                  curve,
                  direction: bottomDirection,
                  bold: isBold,
                }
              );
              break;
            case "arc-top":
              const topRadius =
                sealType === "ellipse" || sealType === "invoice"
                  ? sealSize / 2 - 60
                  : sealSize / 2 - 50;
              // 获取用户设置的防伪码方向
              let topDirection = direction;
              // 如果方向是水平或垂直，使用默认逆时针
              if (direction === "horizontal" || direction === "vertical") {
                topDirection = "counterclockwise";
              }
              drawArcText(
                ctx,
                code,
                centerX + offsetX,
                centerY + offsetY,
                topRadius,
                Math.PI * 1.3,
                Math.PI * 1.7,
                {
                  fontSize,
                  fontFamily,
                  color,
                  letterSpacing: spacing,
                  curve,
                  direction: topDirection,
                  bold: isBold,
                }
              );
              break;
          }

          ctx.restore();
        }

        // 添加真实感效果
        function addRealisticEffects() {
          const intensity =
            parseInt(document.getElementById("effectIntensity").value) / 100;
          if (activeEffects.includes("texture")) {
            const textureIntensity = 0.1 + intensity * 0.4;
            for (let i = 0; i < canvas.width; i += 2) {
              for (let j = 0; j < canvas.height; j += 2) {
                if (Math.random() < textureIntensity) {
                  const alpha = Math.random() * 0.2;
                  ctx.fillStyle = `rgba(0,0,0,${alpha})`;
                  ctx.fillRect(i, j, 1, 1);
                }
              }
            }
          }
          if (activeEffects.includes("ink")) {
            const inkIntensity = intensity * 0.8;
            const imageData = ctx.getImageData(
              0,
              0,
              canvas.width,
              canvas.height
            );
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
              if (data[i] > 100 || data[i + 1] < 100 || data[i + 2] < 100) {
                if (Math.random() < inkIntensity) {
                  if (Math.random() > 0.5) {
                    data[i] = Math.min(255, data[i] + 30 * intensity);
                  } else {
                    data[i] = Math.max(0, data[i] - 30 * intensity);
                  }
                }
              }
            }
            ctx.putImageData(imageData, 0, 0);
          }
          if (activeEffects.includes("distress")) {
            ctx.save();
            ctx.globalCompositeOperation = "destination-out";
            const distressIntensity = intensity * 0.5;
            for (let i = 0; i < 20 * intensity; i++) {
              const angle = Math.random() * Math.PI * 2;
              const distance = canvas.width / 2 - 10 + Math.random() * 10;
              const x = canvas.width / 2 + Math.cos(angle) * distance;
              const y = canvas.height / 2 + Math.sin(angle) * distance;
              const size = 2 + Math.random() * 5 * intensity;
              ctx.beginPath();
              ctx.arc(x, y, size, 0, Math.PI * 2);
              ctx.fill();
            }
            ctx.restore();
          }
          if (activeEffects.includes("shadow")) {
            const tempCanvas = document.createElement("canvas");
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext("2d");
            tempCtx.drawImage(canvas, 0, 0);
            ctx.save();
            ctx.shadowColor = "rgba(0,0,0,0.3)";
            ctx.shadowBlur = 10 * intensity;
            ctx.shadowOffsetX = 5 * intensity;
            ctx.shadowOffsetY = 5 * intensity;
            ctx.drawImage(tempCanvas, 0, 0);
            ctx.restore();
          }
          if (activeEffects.includes("noise")) {
            const noiseIntensity = intensity * 0.3;
            const imageData = ctx.getImageData(
              0,
              0,
              canvas.width,
              canvas.height
            );
            const data = imageData.data;
            for (let i = 0; i < data.length; i += 4) {
              if (Math.random() < noiseIntensity) {
                const noise = (Math.random() - 0.5) * 50;
                data[i] = Math.min(255, Math.max(0, data[i] + noise));
                data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + noise));
                data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + noise));
              }
            }
            ctx.putImageData(imageData, 0, 0);
          }
        }

        // 绘制印章主函数
        function drawSeal() {
          const size =
            parseInt(document.getElementById("outputSize")?.value) || 400;
          canvas.width = canvas.height = size;
          ctx.save();
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          const transparentBg =
            document.getElementById("transparentBg").checked;
          let bgColor = document.getElementById("bgColor")?.value || "#fff";
          if (document.body.classList.contains("seal-night")) {
            bgColor = "#181a20";
          }
          if (!transparentBg) {
            ctx.fillStyle = bgColor;
            ctx.fillRect(0, 0, size, size);
          }

          if (previewBgImage) {
            ctx.drawImage(previewBgImage, 0, 0, size, size);
          }

          ctx.translate(size / 2, size / 2);
          ctx.scale(zoomLevel, zoomLevel);
          ctx.rotate((rotationAngle * Math.PI) / 180);
          ctx.translate(-size / 2, -size / 2);

          const type = document.getElementById("sealType").value;
          const mainText = document.getElementById("mainText").value;
          const subText = document.getElementById("subText").value;
          const mainColor = document.getElementById("mainTextColor").value;
          const subColor = document.getElementById("subTextColor").value;
          let color = document.getElementById("sealColor").value;
          const fontSize = parseInt(
            document.getElementById("mainFontSize").value
          );
          const letterSpacing = parseInt(
            document.getElementById("mainLetterSpacing").value
          );
          const fontFamily = document.getElementById("mainFont").value;
          const subFont = document.getElementById("subFont").value;
          const subFontSize = parseInt(
            document.getElementById("subFontSize").value
          );
          const pattern = document.getElementById("centerPattern").value;
          const patternSize = parseInt(
            document.getElementById("patternSize").value
          );
          const curve = parseInt(
            document.getElementById("mainTextCurve").value
          );
          const borderStyle = document.getElementById("borderStyle").value;
          const borderWidth =
            parseInt(document.getElementById("borderWidth")?.value) || 3;
          const padding =
            parseInt(document.getElementById("padding")?.value) || 0;
          let patternColor =
            document.getElementById("patternColor")?.value || color;
          const patternOffsetX = parseInt(
            document.getElementById("patternOffsetX").value
          );
          const patternOffsetY = parseInt(
            document.getElementById("patternOffsetY").value
          );
          const mainTextDirection =
            document.getElementById("mainTextDirection").value;
          const mainBold = document.getElementById("mainBold").checked;
          const mainItalic = document.getElementById("mainItalic").checked;
          const mainTextOffset =
            parseInt(document.getElementById("mainTextOffset")?.value) || 0;
          const subTextOffset =
            parseInt(document.getElementById("subTextOffset")?.value) || 0;
          if (document.body.classList.contains("seal-night")) {
            color = "#ff4d4f";
            patternColor = "#ff4d4f";
            mainColor = "#ff4d4f";
            subColor = "#ff4d4f";
          }

          // 边框绘制
          if (borderStyle !== "none") {
            ctx.save();
            ctx.strokeStyle = color;
            ctx.lineWidth = borderWidth;
            if (borderStyle === "dashed") {
              ctx.setLineDash([10, 5]);
            } else if (borderStyle === "dotted") {
              ctx.setLineDash([2, 2]);
            } else {
              ctx.setLineDash([]);
            }
            ctx.beginPath();
            if (type === "circle") {
              ctx.arc(
                size / 2,
                size / 2,
                size / 2 - 10 - padding,
                0,
                Math.PI * 2
              );
            } else if (type === "ellipse" || type === "invoice") {
              ctx.ellipse(
                size / 2,
                size / 2,
                size / 2 - 5 - padding,
                size / 2 - 30 - padding,
                0,
                0,
                Math.PI * 2
              );
            } else if (type === "square") {
              ctx.rect(
                10 + padding,
                10 + padding,
                size - 20 - 2 * padding,
                size - 20 - 2 * padding
              );
            } else if (type === "triangle") {
              const side = size - 20 - 2 * padding;
              const height = (side * Math.sqrt(3)) / 2;
              const cx = size / 2;
              const cy = size / 2;
              ctx.moveTo(cx, cy - height / 2);
              ctx.lineTo(cx - side / 2, cy + height / 2);
              ctx.lineTo(cx + side / 2, cy + height / 2);
              ctx.closePath();
            }
            ctx.stroke();
            ctx.restore();
          }

          // 双线边框
          if (borderStyle === "double") {
            ctx.save();
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.setLineDash([]);
            ctx.beginPath();
            if (type === "circle") {
              ctx.arc(
                size / 2,
                size / 2,
                size / 2 - 20 - padding,
                0,
                Math.PI * 2
              );
            } else if (type === "ellipse" || type === "invoice") {
              ctx.ellipse(
                size / 2,
                size / 2,
                size / 2 - 20 - padding,
                size / 2 - 40 - padding,
                0,
                0,
                Math.PI * 2
              );
            } else if (type === "square") {
              ctx.rect(
                20 + padding,
                20 + padding,
                size - 40 - 2 * padding,
                size - 40 - 2 * padding
              );
            } else if (type === "triangle") {
              const side = size - 40 - 2 * padding;
              const height = (side * Math.sqrt(3)) / 2;
              const cx = size / 2;
              const cy = size / 2;
              ctx.moveTo(cx, cy - height / 2);
              ctx.lineTo(cx - side / 2, cy + height / 2);
              ctx.lineTo(cx + side / 2, cy + height / 2);
              ctx.closePath();
            }
            ctx.stroke();
            ctx.restore();
          }

          // 主文字（弧形）
          if (mainText) {
            const baseRadius =
              type === "ellipse" || type === "invoice"
                ? size / 2 - 40 - padding
                : size / 2 - 30 - padding;
            const radius = baseRadius + mainTextOffset;
            const mainStartAngle =
              (parseInt(document.getElementById("mainTextStartAngle").value) *
                Math.PI) /
              180;
            const angleSpan = Math.PI * 1.4; // 角度跨度
            const startAngle = mainStartAngle;
            const endAngle = startAngle + angleSpan;
            drawArcText(
              ctx,
              mainText,
              size / 2,
              size / 2,
              radius,
              startAngle,
              endAngle,
              {
                fontSize,
                fontFamily,
                color: mainColor,
                letterSpacing,
                curve,
                direction: mainTextDirection,
                bold: mainBold,
                italic: mainItalic,
              }
            );

            // 保存主文字的结束角度，用于副文字首尾相连
            window.mainTextEndAngle = endAngle;
          }

          // 副文字（可选弧形或水平）
          if (subText) {
            // ===== 副文字（两行版） =====
            const subTextRaw = document.getElementById("subText").value.trim();
            const subLines = subTextRaw.split(/\n/).slice(0, 2); // 最多两行
            const subCurve = parseInt(
              document.getElementById("subTextCurve").value
            );
            const subLetterSpacing = parseInt(
              document.getElementById("subLetterSpacing").value
            );
            const subTextDirection =
              document.getElementById("subTextDirection").value;
            const subBold = document.getElementById("subBold").checked;
            const subItalic = document.getElementById("subItalic").checked;
            const fontStyle = `${subBold ? "bold " : ""}${
              subItalic ? "italic " : ""
            }${subFontSize}px ${subFont}`;

            if (subLines.length) {
              ctx.font = fontStyle;
              ctx.fillStyle = subColor;
              ctx.textAlign = "center";
              ctx.textBaseline = "middle";

              // 垂直间距：一行高度 ＋ 行距 6 px
              const lineHeight = subFontSize + 6;
              // 基准 Y：椭圆章略偏下，其它居中
              let baseY =
                size / 2 +
                (type === "ellipse" || type === "invoice"
                  ? size / 4 - padding
                  : size / 2 - 40 - padding);

              // 如果只有一行，保持旧逻辑；两行则平均分布在基准线上下
              const startY =
                subLines.length === 1
                  ? baseY + subTextOffset
                  : baseY + subTextOffset - lineHeight / 2;

              subLines.forEach((line, idx) => {
                const y = startY + idx * lineHeight;
                if (subCurve > 0) {
                  // 仅替换“副文字弧形”分支
                  const subLines = subTextRaw.split("\n").slice(0, 2);
                  for (let idx = 0; idx < subLines.length; idx++) {
                    const line = subLines[idx];

                    /* ------ 1. 半径：用正的，往外鼓 ------ */
                    const baseRadius =
                      type === "ellipse" || type === "invoice"
                        ? size * 0.35 // 椭圆章稍小
                        : size * 0.4; // 圆章
                    // 第二行往里收 10 px，防止重叠
                    const radius = baseRadius - idx * 10 + subTextOffset;

                    /* ------ 2. 角度：固定在下半圆 ------ */
                    const startAngle =
                      (parseInt(
                        document.getElementById("subTextStartAngle").value
                      ) *
                        Math.PI) /
                      180;
                    const angleSpan = Math.PI * 1.4; // 两边各 70°，共 140°
                    const endAngle = startAngle + angleSpan;

                    /* ------ 3. 圆心：画布中心 ------ */
                    drawArcText(
                      ctx,
                      line,
                      size / 2,
                      size / 2,
                      radius,
                      startAngle,
                      endAngle,
                      {
                        fontSize: subFontSize,
                        fontFamily: subFont,
                        color: subColor,
                        letterSpacing: subLetterSpacing,
                        curve: subCurve,
                        direction: subTextDirection,
                        bold: subBold,
                        italic: subItalic,
                      }
                    );
                  }
                } else {
                  // 水平模式
                  if (subLetterSpacing > 0) {
                    // 手动字符间距（同旧逻辑）
                    const chars = line.split("");
                    const totalWidth =
                      chars.reduce((w, c) => w + ctx.measureText(c).width, 0) +
                      (chars.length - 1) * subLetterSpacing;
                    let x = size / 2 - totalWidth / 2;
                    chars.forEach((c) => {
                      const w = ctx.measureText(c).width;
                      ctx.fillText(c, x + w / 2, y);
                      x += w + subLetterSpacing;
                    });
                  } else {
                    ctx.fillText(line, size / 2, y);
                  }
                }
              });
            }
          }

          // 中心图案
          const cx = size / 2 + patternOffsetX;
          const cy = size / 2 + patternOffsetY;
          if (pattern === "star") {
            drawStar(ctx, cx, cy, patternSize, patternColor);
          } else if (pattern === "circle") {
            ctx.beginPath();
            ctx.arc(cx, cy, patternSize / 2, 0, Math.PI * 2);
            ctx.fillStyle = patternColor;
            ctx.fill();
          } else if (pattern === "square") {
            ctx.fillStyle = patternColor;
            ctx.fillRect(
              cx - patternSize / 2,
              cy - patternSize / 2,
              patternSize,
              patternSize
            );
          } else if (pattern === "triangle") {
            drawTriangle(ctx, cx, cy, patternSize, patternColor);
          } else if (pattern === "custom" && customImage) {
            ctx.drawImage(
              customImage,
              cx - patternSize / 2,
              cy - patternSize / 2,
              patternSize,
              patternSize
            );
          }

          // 绘制防伪码
          drawAntiCounterfeitCode(ctx, size / 2, size / 2, size, type);

          ctx.restore();
          addRealisticEffects();
        }

        // 初始化
        drawSeal();
        function syncSealNightClass() {
          var isDark =
            document.body.classList.contains("is-dark") ||
            document.body.classList.contains("dark-mode");
          if (isDark) {
            document.body.classList.add("seal-night");
          } else {
            document.body.classList.remove("seal-night");
          }
          drawSeal();
        }
        var nightSwitch = document.querySelector(
          ".progress-rating.dark-switch"
        );
        if (nightSwitch) {
          nightSwitch.addEventListener("click", function () {
            setTimeout(syncSealNightClass, 50);
          });
        }
        setTimeout(syncSealNightClass, 100);
      });
    </script>

    <style>
      .circle-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background-color: #f5f6fa;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
      }
      .fs-16 {
        font-size: 16px;
      }
      .hover-shadow:hover {
        transform: translateY(-5px);
        transition: all 0.3s ease;
      }
      /* 评论区样式增强 */
      #plugin_comment_list {
        max-height: 600px;
        overflow-y: auto;
        padding-right: 10px;
      }
      .nk-comment-item {
        border-bottom: 1px solid #f0f0f0;
        padding-bottom: 10px;
        margin-bottom: 15px;
      }
      .nk-comment-item:last-child {
        border-bottom: none;
      }
      .toggle-content {
        color: #6576ff;
        text-decoration: none;
        font-size: 0.85rem;
        display: block;
        margin-top: 5px;
      }
      .reply-btn {
        font-size: 0.8rem;
        padding: 2px 8px;
      }
      .comment-content {
        margin: 10px 0;
      }
    </style>
  </body>
</html>
